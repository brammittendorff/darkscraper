{
  "uid": "darkscraper-monitor",
  "title": "Network Monitor",
  "timezone": "browser",
  "schemaVersion": 39,
  "version": 1,
  "refresh": "5s",
  "time": {"from": "now-1h", "to": "now"},
  "timepicker": {"refresh_intervals": ["5s", "10s", "30s", "1m"]},
  "links": [
    {"title": "Overview", "url": "/d/darkscraper-overview", "type": "link"},
    {"title": "Network Analysis", "url": "/d/darkscraper-network-analysis", "type": "link"},
    {"title": "Correlations", "url": "/d/darkscraper-correlations", "type": "link"},
    {"title": "Search", "url": "/d/darkscraper-search", "type": "link"}
  ],
  "panels": [
    {"id": 1, "title": "TOR Status", "type": "stat", "gridPos": {"h": 3, "w": 4, "x": 0, "y": 0}, "datasource": {"type": "grafana-postgresql-datasource", "uid": "darkscraper-pg"}, "targets": [{"rawSql": "SELECT CASE WHEN MAX(fetched_at) > NOW() - INTERVAL '5 minutes' THEN 1 WHEN MAX(fetched_at) > NOW() - INTERVAL '30 minutes' THEN 0.5 ELSE 0 END as status FROM pages WHERE network = 'tor';", "format": "table", "refId": "A"}], "fieldConfig": {"defaults": {"mappings": [{"type": "value", "options": {"1": {"text": "UP", "color": "green"}, "0.5": {"text": "SLOW", "color": "yellow"}, "0": {"text": "DOWN", "color": "red"}}}], "thresholds": {"steps": [{"color": "red", "value": 0}, {"color": "yellow", "value": 0.5}, {"color": "green", "value": 1}]}}, "overrides": []}, "options": {"textMode": "value", "colorMode": "background"}},
    {"id": 2, "title": "TOR Last Active", "type": "stat", "gridPos": {"h": 3, "w": 4, "x": 0, "y": 3}, "datasource": {"type": "grafana-postgresql-datasource", "uid": "darkscraper-pg"}, "targets": [{"rawSql": "SELECT COALESCE(EXTRACT(EPOCH FROM (NOW() - MAX(fetched_at)))::int, 999999) as value FROM pages WHERE network = 'tor';", "format": "table", "refId": "A"}], "fieldConfig": {"defaults": {"unit": "s", "thresholds": {"steps": [{"color": "green", "value": 0}, {"color": "yellow", "value": 300}, {"color": "red", "value": 1800}]}, "mappings": [{"type": "special", "options": {"match": "null", "result": {"text": "Never"}}}]}, "overrides": []}, "options": {"textMode": "value_and_name"}},

    {"id": 3, "title": "I2P Status", "type": "stat", "gridPos": {"h": 3, "w": 4, "x": 5, "y": 0}, "datasource": {"type": "grafana-postgresql-datasource", "uid": "darkscraper-pg"}, "targets": [{"rawSql": "SELECT CASE WHEN MAX(fetched_at) > NOW() - INTERVAL '5 minutes' THEN 1 WHEN MAX(fetched_at) > NOW() - INTERVAL '30 minutes' THEN 0.5 ELSE 0 END FROM pages WHERE network = 'i2p';", "format": "table", "refId": "A"}], "fieldConfig": {"defaults": {"mappings": [{"type": "value", "options": {"1": {"text": "UP", "color": "green"}, "0.5": {"text": "SLOW", "color": "yellow"}, "0": {"text": "DOWN", "color": "red"}}}], "thresholds": {"steps": [{"color": "red", "value": 0}, {"color": "yellow", "value": 0.5}, {"color": "green", "value": 1}]}}, "overrides": []}, "options": {"textMode": "value", "colorMode": "background"}},
    {"id": 4, "title": "I2P Last Active", "type": "stat", "gridPos": {"h": 3, "w": 4, "x": 5, "y": 3}, "datasource": {"type": "grafana-postgresql-datasource", "uid": "darkscraper-pg"}, "targets": [{"rawSql": "SELECT COALESCE(EXTRACT(EPOCH FROM (NOW() - MAX(fetched_at)))::int, 999999) as value FROM pages WHERE network = 'i2p';", "format": "table", "refId": "A"}], "fieldConfig": {"defaults": {"unit": "s", "thresholds": {"steps": [{"color": "green", "value": 0}, {"color": "yellow", "value": 300}, {"color": "red", "value": 1800}]}}, "overrides": []}},

    {"id": 5, "title": "HYPHANET Status", "type": "stat", "gridPos": {"h": 3, "w": 4, "x": 10, "y": 0}, "datasource": {"type": "grafana-postgresql-datasource", "uid": "darkscraper-pg"}, "targets": [{"rawSql": "SELECT CASE WHEN MAX(fetched_at) > NOW() - INTERVAL '5 minutes' THEN 1 WHEN MAX(fetched_at) > NOW() - INTERVAL '30 minutes' THEN 0.5 ELSE 0 END FROM pages WHERE network = 'hyphanet';", "format": "table", "refId": "A"}], "fieldConfig": {"defaults": {"mappings": [{"type": "value", "options": {"1": {"text": "UP", "color": "green"}, "0.5": {"text": "SLOW", "color": "yellow"}, "0": {"text": "DOWN", "color": "red"}}}], "thresholds": {"steps": [{"color": "red", "value": 0}, {"color": "yellow", "value": 0.5}, {"color": "green", "value": 1}]}}, "overrides": []}, "options": {"textMode": "value", "colorMode": "background"}},
    {"id": 6, "title": "HYPHANET Last Active", "type": "stat", "gridPos": {"h": 3, "w": 4, "x": 10, "y": 3}, "datasource": {"type": "grafana-postgresql-datasource", "uid": "darkscraper-pg"}, "targets": [{"rawSql": "SELECT COALESCE(EXTRACT(EPOCH FROM (NOW() - MAX(fetched_at)))::int, 999999) as value FROM pages WHERE network = 'hyphanet';", "format": "table", "refId": "A"}], "fieldConfig": {"defaults": {"unit": "s", "thresholds": {"steps": [{"color": "green", "value": 0}, {"color": "yellow", "value": 300}, {"color": "red", "value": 1800}]}}, "overrides": []}},

    {"id": 7, "title": "LOKINET Status", "type": "stat", "gridPos": {"h": 3, "w": 4, "x": 15, "y": 0}, "datasource": {"type": "grafana-postgresql-datasource", "uid": "darkscraper-pg"}, "targets": [{"rawSql": "SELECT CASE WHEN MAX(fetched_at) > NOW() - INTERVAL '5 minutes' THEN 1 WHEN MAX(fetched_at) > NOW() - INTERVAL '30 minutes' THEN 0.5 ELSE 0 END FROM pages WHERE network = 'lokinet';", "format": "table", "refId": "A"}], "fieldConfig": {"defaults": {"mappings": [{"type": "value", "options": {"1": {"text": "UP", "color": "green"}, "0.5": {"text": "SLOW", "color": "yellow"}, "0": {"text": "DOWN", "color": "red"}}}], "thresholds": {"steps": [{"color": "red", "value": 0}, {"color": "yellow", "value": 0.5}, {"color": "green", "value": 1}]}}, "overrides": []}, "options": {"textMode": "value", "colorMode": "background"}},
    {"id": 8, "title": "LOKINET Last Active", "type": "stat", "gridPos": {"h": 3, "w": 4, "x": 15, "y": 3}, "datasource": {"type": "grafana-postgresql-datasource", "uid": "darkscraper-pg"}, "targets": [{"rawSql": "SELECT COALESCE(EXTRACT(EPOCH FROM (NOW() - MAX(fetched_at)))::int, 999999) as value FROM pages WHERE network = 'lokinet';", "format": "table", "refId": "A"}], "fieldConfig": {"defaults": {"unit": "s", "thresholds": {"steps": [{"color": "green", "value": 0}, {"color": "yellow", "value": 300}, {"color": "red", "value": 1800}]}}, "overrides": []}},

    {"id": 9, "title": "ZERONET Status", "type": "stat", "gridPos": {"h": 3, "w": 4, "x": 20, "y": 0}, "datasource": {"type": "grafana-postgresql-datasource", "uid": "darkscraper-pg"}, "targets": [{"rawSql": "SELECT CASE WHEN MAX(fetched_at) > NOW() - INTERVAL '5 minutes' THEN 1 WHEN MAX(fetched_at) > NOW() - INTERVAL '30 minutes' THEN 0.5 ELSE 0 END FROM pages WHERE network = 'zeronet';", "format": "table", "refId": "A"}], "fieldConfig": {"defaults": {"mappings": [{"type": "value", "options": {"1": {"text": "UP", "color": "green"}, "0.5": {"text": "SLOW", "color": "yellow"}, "0": {"text": "DOWN", "color": "red"}}}], "thresholds": {"steps": [{"color": "red", "value": 0}, {"color": "yellow", "value": 0.5}, {"color": "green", "value": 1}]}}, "overrides": []}, "options": {"textMode": "value", "colorMode": "background"}},
    {"id": 10, "title": "ZERONET Last Active", "type": "stat", "gridPos": {"h": 3, "w": 4, "x": 20, "y": 3}, "datasource": {"type": "grafana-postgresql-datasource", "uid": "darkscraper-pg"}, "targets": [{"rawSql": "SELECT COALESCE(EXTRACT(EPOCH FROM (NOW() - MAX(fetched_at)))::int, 999999) as value FROM pages WHERE network = 'zeronet';", "format": "table", "refId": "A"}], "fieldConfig": {"defaults": {"unit": "s", "thresholds": {"steps": [{"color": "green", "value": 0}, {"color": "yellow", "value": 300}, {"color": "red", "value": 1800}]}}, "overrides": []}},

    {"id": 11, "title": "Network Health Summary", "type": "table", "gridPos": {"h": 8, "w": 24, "x": 0, "y": 6}, "datasource": {"type": "grafana-postgresql-datasource", "uid": "darkscraper-pg"}, "targets": [{"rawSql": "WITH networks AS (SELECT unnest(ARRAY['tor', 'i2p', 'hyphanet', 'lokinet', 'zeronet']) as network) SELECT n.network, COALESCE(COUNT(p.id), 0) as pages_24h, COALESCE((SELECT COUNT(*) FROM dead_urls WHERE network = n.network AND failure_type = 'dead'), 0) as dead, COALESCE((SELECT COUNT(*) FROM dead_urls WHERE network = n.network AND failure_type = 'unreachable'), 0) as unreachable, COALESCE(ROUND(AVG(p.response_time_ms)), 0)::int as avg_ms, COALESCE(to_char(MAX(p.fetched_at), 'YYYY-MM-DD HH24:MI:SS'), 'Never') as last_active FROM networks n LEFT JOIN pages p ON p.network = n.network AND p.fetched_at > NOW() - INTERVAL '24 hours' GROUP BY n.network ORDER BY pages_24h DESC;", "format": "table", "refId": "A"}], "options": {"showHeader": true}},

    {"id": 12, "title": "Network Activity (Success vs Failures)", "type": "timeseries", "gridPos": {"h": 10, "w": 24, "x": 0, "y": 14}, "datasource": {"type": "grafana-postgresql-datasource", "uid": "darkscraper-pg"}, "targets": [{"rawSql": "WITH all_minutes AS (SELECT DISTINCT date_trunc('minute', fetched_at) as time FROM pages UNION SELECT DISTINCT date_trunc('minute', last_attempt_at) FROM dead_urls), all_networks AS (SELECT unnest(ARRAY['tor', 'i2p', 'hyphanet', 'lokinet', 'zeronet']) as network) SELECT m.time, n.network || ' Success' as metric, COALESCE((SELECT COUNT(*) FROM pages WHERE network = n.network AND date_trunc('minute', fetched_at) = m.time), 0) as value FROM all_minutes m CROSS JOIN all_networks n UNION ALL SELECT m.time, n.network || ' Failures' as metric, COALESCE((SELECT COUNT(*) FROM dead_urls WHERE network = n.network AND date_trunc('minute', last_attempt_at) = m.time), 0) as value FROM all_minutes m CROSS JOIN all_networks n ORDER BY time, metric;", "format": "time_series", "refId": "A"}], "fieldConfig": {"defaults": {"custom": {"lineWidth": 2, "drawStyle": "line", "spanNulls": true, "lineInterpolation": "linear", "showPoints": "never", "fillOpacity": 0}, "color": {"mode": "palette-classic"}}, "overrides": []}},

    {"id": 13, "title": "Recent Failures", "type": "table", "gridPos": {"h": 10, "w": 24, "x": 0, "y": 24}, "datasource": {"type": "grafana-postgresql-datasource", "uid": "darkscraper-pg"}, "targets": [{"rawSql": "SELECT network, failure_type, url, retry_count, LEFT(last_error, 120) as error, to_char(last_attempt_at, 'HH24:MI:SS') as time FROM dead_urls WHERE last_attempt_at > NOW() - INTERVAL '1 hour' ORDER BY last_attempt_at DESC LIMIT 100;", "format": "table", "refId": "A"}], "options": {"showHeader": true}}
  ]
}
